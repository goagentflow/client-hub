# AgentFlow Pitch Hub v0.1

## Coding Standards

Follow GOLDEN_RULES.md for all development. Key principles:
- Question → Plan → Approval → Code workflow
- SRP, DRY, SoC, Security by Default
- No file over 300 lines, no function over 40 lines
- Validate all inputs, never hardcode secrets

---

## What This Project Is

AgentFlow Pitch Hub is a client relationship portal built on Microsoft 365. Two hub types: Pitch Hubs (new business) and Client Hubs (active clients). The frontend wireframe is complete for both. The middleware API layer (113 endpoints, 46 real, 67 stubbed) is in active development with Azure AD authentication code-complete.

**Current work:** Phase 0b — codebase refactor (Prisma migration, AUTH_MODE/DATA_BACKEND config model, TenantRepository pattern, route migration).

## Key Documentation

- **GOLDEN_RULES.md** — Coding standards for all development
- **AGENTS.md** — Architecture canon: Simple, Clean, DRY, Secure
- **docs/PRODUCTION_ROADMAP.md** — Detailed phase plan with endpoint inventory (canon architecture)
- **docs/API_SPECIFICATION.md** — Complete 113-endpoint API contract
- **docs/middleware/MSAL_AUTH_IMPLEMENTATION_PLAN.md** — Auth design (approved by senior dev)
- **VISION_AND_ASSUMPTIONS.md** — Product vision and middleware assumptions
- **progress/STATUS.md** — Master project status, roadmap, key decisions
- **README.md** — Project setup and brand guidelines

---

## What We've Built

### Frontend (Complete)

**Pitch Hubs — Staff View:**
- Login (demo credentials + MSAL code ready)
- Hub List (paginated grid with filters, search, create)
- Hub Overview (activity feed, notes, engagement stats)
- Client Portal management, Proposal, Videos, Documents, Messages, Meetings, Questionnaire

**Pitch Hubs — Client View:**
- Overview, Proposal, Videos, Documents, Messages, Meetings, Questionnaire, People

**Client Hubs (Phase 2):**
- Hub Conversion (pitch → client)
- Projects with milestones
- Relationship Health Dashboard, Expansion Radar
- Client Intelligence (Instant Answers, Meeting Prep, Performance Narratives)
- Decision Queue, History & Alerts
- Leadership Portfolio View (admin-only)

### Middleware (In Active Development)

- Express/TypeScript with structured logging (Pino) and correlation IDs
- Auth: Azure AD JWT (RS256 via jose) + portal JWT (HS256) + demo headers
- Config: `AUTH_MODE` (azure_ad | demo) + `DATA_BACKEND` (azure_pg | mock)
- Database: Prisma 6 ORM with TenantRepository and AdminRepository
- `DATA_BACKEND=azure_pg` connects to Supabase PostgreSQL for MVP (same Prisma interface — host configured via `DATABASE_URL`)
- Hub CRUD with search/filter/sort
- Staff guards on all non-portal endpoints
- Public endpoints with rate limiting
- 84 tests passing across 5 test files
- 46 real endpoints, 67 stubbed (501) for future phases

## What We're Building Next

See `docs/PRODUCTION_ROADMAP.md` for the full phase plan (Phases 0-10). Current priority is completing Phase 0b (codebase refactor) and deploying the MVP on Google Cloud Run + Supabase. Full Azure deployment (Phase 0a) deferred until scaling beyond MVP.

---

## Tech Stack

**Frontend:** Vite, TypeScript, React, Tailwind CSS, shadcn/ui, MSAL.js

**Middleware:** Express, TypeScript, Prisma 6, jose, Zod, Pino

**MVP deployment:** Google Cloud Run + Supabase PostgreSQL + Azure AD auth (live, first client)
**Production target:** Azure App Service + Static Web Apps + Azure PostgreSQL + Blob Storage (Phase 0a)

---

## Brand Guidelines

### Colours

| Name | Hex | Usage |
|------|-----|-------|
| Gradient Blue | #a6c3e8 | Headers, buttons, hero sections |
| Gradient Purple | #c6b8e4 | Backgrounds, accents, gradients |
| Deep Navy | #2c3e50 | Text overlays, navigation, icons |
| Warm Cream | #fdfaf6 | Main background |
| Soft Coral | #f7a89d | Call-to-action buttons (sparingly) |
| Sage Green | #a1bba2 | Illustrations, icons, balance |
| Dark Grey | #3c3c3c | Primary body text |
| Medium Grey | #6b6b6b | Secondary text, metadata |
| Bold Royal Blue | #3d5fa8 | Headings, emphasis |
| Rich Violet | #7952b3 | Alternating headings, key terms |

### Typography

- **Font:** Calibri (fallback to system sans-serif)
- **Headings:** Bold Royal Blue (#3d5fa8) or Rich Violet (#7952b3)
- **Body:** Dark Grey (#3c3c3c)
- **Secondary:** Medium Grey (#6b6b6b)

### Logo

https://www.goagentflow.com/assets/images/AgentFlowLogo.svg

---

## Code Patterns

### Component Structure

```tsx
// Use shadcn/ui components where possible
import { Button } from "@/components/ui/button"
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card"

// Tailwind for custom styling, using brand colours
<div className="bg-[#fdfaf6] text-[#3c3c3c]">
  <h1 className="text-[#3d5fa8] font-bold">Heading</h1>
</div>
```

### Placeholder Data

All frontend data is placeholder. Use realistic-looking fake data that demonstrates the UI:

```tsx
// Good: Realistic placeholder
const pitchHubs = [
  { id: 1, name: "Whitmore & Associates", status: "Active", lastActivity: "2 hours ago" },
  { id: 2, name: "Hartley Grant Partners", status: "Draft", lastActivity: "Yesterday" },
];
```

---

## Folder Structure

```
/
  .cursorrules             ← You are here
  GOLDEN_RULES.md          ← Coding standards
  AGENTS.md                ← Architecture canon
  README.md                ← Setup and overview
  progress/STATUS.md       ← Master project status
  /docs
    PRODUCTION_ROADMAP.md  ← Phase plan
    API_SPECIFICATION.md   ← API contract
    middleware/
      MSAL_AUTH_IMPLEMENTATION_PLAN.md ← Auth design
  /src                     ← Frontend (React)
    /components/ui         ← shadcn/ui components
    /pages                 ← Page views
    /services              ← API client, auth service
  /middleware              ← Backend (Express)
    /src
      /config              ← env.ts (AUTH_MODE, DATA_BACKEND)
      /middleware           ← Auth, hub-access, inject-repository
      /routes              ← 113 API endpoints
      /adapters            ← Data layer adapters
      /db                  ← Prisma client, TenantRepository
    /prisma
      schema.prisma        ← Database schema
```

---

## When In Doubt

1. Read `progress/STATUS.md` — current state and key decisions
2. Read `docs/PRODUCTION_ROADMAP.md` — detailed phase plan
3. Check GOLDEN_RULES.md — apply pragmatically
4. Use the brand colours — consistency matters
5. Make it look real — placeholder data should be believable
